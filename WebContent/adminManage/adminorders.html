<!doctype html>
<html lang="ch">

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="description" content="手机商城后台">
		<meta name="keywords" content="手机商城后台">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		<meta name="format-detection" content="telephone=no">
		<title>手机商城后台</title>
		<script src="js/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script>
			$(function() {
				$(".meun-item").click(function() {
					$(".meun-item").removeClass("meun-item-active");
					$(this).addClass("meun-item-active");
					var itmeObj = $(".meun-item").find("img");
					itmeObj.each(function() {
						var items = $(this).attr("src");
						items = items.replace("_grey.png", ".png");
						items = items.replace(".png", "_grey.png")
						$(this).attr("src", items);
					});
					var attrObj = $(this).find("img").attr("src");;
					attrObj = attrObj.replace("_grey.png", ".png");
					$(this).find("img").attr("src", attrObj);
				});
				$("#topAD").click(function() {
					$("#topA").toggleClass(" glyphicon-triangle-right");
					$("#topA").toggleClass(" glyphicon-triangle-bottom");
				});
				$("#topBD").click(function() {
					$("#topB").toggleClass(" glyphicon-triangle-right");
					$("#topB").toggleClass(" glyphicon-triangle-bottom");
				});
				$("#topCD").click(function() {
					$("#topC").toggleClass(" glyphicon-triangle-right");
					$("#topC").toggleClass(" glyphicon-triangle-bottom");
				});
				$(".toggle-btn").click(function() {
					$("#leftMeun").toggleClass("show");
					$("#rightContent").toggleClass("pd0px");
				})
			})
		</script>
		<!--[if lt IE 9]>
  <script src="js/html5shiv.min.js"></script>
  <script src="js/respond.min.js"></script>
<![endif]-->
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="css/common.css" />
		<link rel="stylesheet" type="text/css" href="css/slide.css" />
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="css/flat-ui.min.css" />
		<link rel="stylesheet" type="text/css" href="css/jquery.nouislider.css">
	</head>

	<body>
		<div id="wrap">
			<!-- 左侧菜单栏目块 -->
			<div class="leftMeun" id="leftMeun">
				<div id="logoDiv">
					<p id="logoP"><img id="logo" alt="左右结构项目" src="images/logo.png"><span>手机商城后台</span></p>
				</div>
				<div id="personInfor">
					
				</div>
				<div class="meun-title">账号管理</div>
				<div class="meun-item">
					<a href="adminindex.html"><img src="images/icon_user_grey.png">用户管理</a>
				</div>
				<div class="meun-item">
					<a href="adminphone.html"><span class="glyphicon glyphicon-phone"></span>&nbsp;&nbsp;&nbsp;&nbsp;手机管理</a>
				</div>
				<div class="meun-item">
					<a href="adminaddress.html">&nbsp;<span class="glyphicon glyphicon-tower"></span>&nbsp;&nbsp;&nbsp;&nbsp;地址管理</a>
				</div>
				<div class="meun-item">
					<a href="admincommit.html"><span class="glyphicon glyphicon-edit"></span>&nbsp;&nbsp;&nbsp;&nbsp;评论管理</a>
				</div>
				<div class="meun-item meun-item-active" href="#order" aria-controls="order" role="tab" data-toggle="tab">&nbsp;<span class="glyphicon glyphicon-gift"></span>&nbsp;&nbsp;&nbsp;&nbsp;订单管理</div>
				<div class="meun-item">
					<a href="adminimages.html">&nbsp;<span class="glyphicon glyphicon-picture"></span>&nbsp;&nbsp;&nbsp;&nbsp;图片管理</a>
				</div>
				<div class="meun-item">
					<a href="adminrepassword.html"><img src="images/icon_change_grey.png">修改密码</a>
				</div>

			</div>
			<!-- 右侧具体内容栏目 -->
			<div id="rightContent">
				<a class="toggle-btn" id="nimei">
					<i class="glyphicon glyphicon-align-justify"></i>
				</a>
				<!-- Tab panes -->
				<div class="tab-content">
					<!--添加用户-->

					<!-- 图片管理 -->

					<!--添加商品图片-->

					<!--修改商品图片-->

					<!--删除图片-->

					<!-- 权限管理模块 -->

					<!--手机管理模块-->

					<!--地址管理模块-->

					<!--添加地址模块-->

					<!--地址修改模块-->

					<!--地址删除警告-->

					<!--评论管理模块-->

					<!--添加评论模态框-->

					<!--评论详情模态框-->

					<!--删除评论模态框-->

					<!--订单管理模块-->
					<div role="tabpanel" class="tab-pane active" id="order">
						<div class="check-div form-inline">
							<div class="col-xs-3">
<!--								<button class="btn btn-yellow btn-xs" data-toggle="modal" data-target="#addOrder">添加订单 </button>-->
							</div>
							<div class="col-xs-4">
								<input type="text" class="form-control input-sm" placeholder="输入文字搜索" id="keyword">
								<button class="btn btn-white btn-xs" id="search">查 询 </button>
							</div>
							
						</div>
						<div class="data-div">
							<div class="row tableHeader">
								<div class="col-xs-2">
									订单号
								</div>

								<div class="col-xs-1">
									用户id
								</div>

								<div class="col-xs-1">
									收货人
								</div>
								<div class="col-xs-2">
									创建时间
								</div>

								<div class="col-xs-2">
									收货地址
								</div>

								<div class="col-xs-2">
									收货手机号码
								</div>
								<div class="col-xs-2">
									操作
								</div>
							</div>
							<div class="tablebody" id="orderlist">
								
							</div>
						</div>
						<!--页码块-->
						<footer class="footer">
							<ul class="pagination">
								<li>
									<a href="#">
										<font color="black">&laquo;</font>
									</a>
								</li>
								<li>
									<a href="#">
										<font color="black">1</font>
									</a>
								</li>
								<li>
									<a href="#">
										<font color="black">2</font>
									</a>
								</li>
								<li>
									<a href="#">
										<font color="black">3</font>
									</a>
								</li>
								<li>
									<a href="#">
										<font color="black">4</font>
									</a>
								</li>
								<li>
									<a href="#">
										<font color="black">5</font>
									</a>
								</li>
								<li>
									<a href="#">
										<font color="black">&raquo;</font>
									</a>
								</li>
								<li class="gray">
									<font color="black">共20页</font>
								</li>

							</ul>
						</footer>
					</div>
					<!--添加订单-->
<!--					<div class="modal fade" id="addOrder" role="dialog" aria-labelledby="gridSystemModalLabel">-->
<!--						<div class="modal-dialog" role="document">-->
<!--							<div class="modal-content">-->
<!--								<div class="modal-header">-->
<!--									<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>-->
<!--									<h4 class="modal-title" id="gridSystemModalLabel">添加订单</h4>-->
<!--								</div>-->
<!--								<div class="modal-body">-->
<!--									<div class="container-fluid">-->
<!--										<form class="form-horizontal">-->
<!--											<div class="form-group ">-->
<!--												<label for="sName" class="col-xs-3 control-label">手机图片：</label>-->
<!--												<div class="col-xs-8 ">-->
<!--													<input id="file-Portrait1" type="file">-->
<!--												</div>-->
<!--											</div>-->
<!--											<div class="form-group">-->
<!--												<label for="sOrd" class="col-xs-3 control-label">商品型号：</label>-->
<!--												<div class="col-xs-8">-->
<!--													<input type="" class="form-control input-sm duiqi" id="sOrd" placeholder="">-->
<!--												</div>-->
<!--											</div>-->
<!--											<div class="form-group">-->
<!--												<label for="sKnot" class="col-xs-3 control-label">手机单价:</label>-->
<!--												<div class="col-xs-8">-->
<!--													<input type="" class="form-control input-sm duiqi" id="sKnot" placeholder="">-->
<!--												</div>-->
<!--											</div>-->
<!--											<div class="form-group">-->
<!--												<label for="sKnot" class="col-xs-3 control-label">商品数量</label>-->
<!--												<div class="col-xs-8">-->
<!--													<input type="" class="form-control input-sm duiqi" id="sKnot" placeholder="">-->
<!--												</div>-->
<!--											</div>-->
<!--											<div class="form-group">-->
<!--												<label for="sKnot" class="col-xs-3 control-label">总价</label>-->
<!--												<div class="col-xs-8">-->
<!--													<input type="" class="form-control input-sm duiqi" id="sKnot" placeholder="">-->
<!--												</div>-->
<!--											</div>-->

<!--										</form>-->
<!--									</div>-->
<!--								</div>-->
<!--								<div class="modal-footer">-->
<!--									<button type="button" class="btn btn-xs btn-white" data-dismiss="modal">取 消</button>-->
<!--									<button type="button" class="btn btn-xs btn-green">保 存</button>-->
<!--								</div>-->
<!--							</div>-->
<!--							&lt;!&ndash; /.modal-content &ndash;&gt;-->
<!--						</div>-->
<!--						&lt;!&ndash; /.modal-dialog &ndash;&gt;-->
<!--					</div>-->
					<!--订单详情模态框-->
					<div class="modal fade" style="margin-left: -350px;"  id="reviseOrder" role="dialog" aria-labelledby="gridSystemModalLabel">
						<div class="modal-dialog" role="document">
							<div class="modal-content" style="width: 900px;" >
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
									<h4 class="modal-title" id="gridSystemModalLabel">订单详情</h4>
								</div>
								<div class="modal-body " >
									<div class="row">
										<div class="col-12">
											<div class="product-table">
												<table class="table table-responsive">
													<colgroup>
														<col style="width: 30%" span="1">
														<col style="width: 15%" span="1">
														<col style="width: 15%" span="1">
														<col style="width: 15%" span="1">
														<col style="width: 15%" span="1">
													</colgroup>
													<thead>
														<tr >
															<th class="product-iamge" scope="col">手机图片</th>
															<th class="product-name" scope="col">手机型号</th>
															<th class="product-price" scope="col">手机单价</th>
															<th class="product-quantity" scope="col">商品数量</th>
															<th class="product-total" scope="col">总价</th>
														</tr>
													</thead>
													<tbody id="itemlist">
														
													</tbody>
												</table>
											</div>
										</div>

									</div>
								</div>

							</div>
							<!-- /.modal-content -->
						</div>
						<!-- /.modal-dialog -->
					</div>
					<!--订单删除模态框-->
					<div class="modal fade" id="deleteOrder" role="dialog" aria-labelledby="gridSystemModalLabel">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
									<h4 class="modal-title" id="gridSystemModalLabel">提示</h4>
								</div>
								<div class="modal-body">
									<div class="container-fluid">
										确定要删除该订单？删除后不可恢复！
									</div>
								</div>
								<div class="modal-footer">
									
								</div>
							</div>
							<!-- /.modal-content -->
						</div>
						<!-- /.modal-dialog -->
					</div>
					<!--添加手机模态框-->

					<!--用户管理模块-->

					<!-- 修改密码模块 -->

					<!--是否为会员管理模块-->

					<!--规则管理模块-->

					<!--时间段管理模块-->

					<!--座位管理模块-->
				</div>
			</div>
		</div>
		<!-- 滑块js -->
		<!--	<script type="text/javascript">
        scale = function(btn, bar, title, unit) {
                this.btn = document.getElementById(btn);
                this.bar = document.getElementById(bar);
                this.title = document.getElementById(title);
                this.step = this.bar.getElementsByTagName("div")[0];
                this.unit = unit;
                this.init();
        };
        scale.prototype = {
                init: function() {
                        var f = this,
                                g = document,
                                b = window,
                                m = Math;
                        f.btn.onmousedown = function(e) {
                                var x = (e || b.event).clientX;
                                var l = this.offsetLeft;
//						var max = f.bar.offsetWidth - this.offsetWidth;
                                var max = f.bar.offsetWidth-20 ;
                                g.onmousemove = function(e) {
                                        var thisX = (e || b.event).clientX;
                                        var to = m.min(max, m.max(-2, l + (thisX - x)));
                                        f.btn.style.left = to+ 'px';
                                        f.ondrag(m.round(m.max(0, to / max) * 100), to);
                                        b.getSelection ? b.getSelection().removeAllRanges() : g.selection.empty();
                                };
                                g.onmouseup = new Function('this.onmousemove=null');
                        };
                },
                ondrag: function(pos, x) {
                        this.step.style.width = Math.max(0, x) +2+ 'px';
                        this.title.innerHTML = pos / 10 + this.unit + "";
                }
        }
        new scale('btn0', 'bar0', 'title0', "分钟");
        new scale('btn1', 'bar1', 'title1', "分钟");
        new scale('btn2', 'bar2', 'title2', "天");
        new scale('btn3', 'bar3', 'title3', "次");
</script>
-->
		<script src="js/jquery.nouislider.js"></script>
		<script src="js/jquery.cookie.js"></script>

		<!-- this page specific inline scripts -->
		<script>
			//min/max slider
			function huadong(my, unit, def, max) {
				$(my).noUiSlider({
					range: [0, max],
					start: [def],
					handles: 1,
					connect: 'upper',
					slide: function() {
						var val = Math.floor($(this).val());
						$(this).find(".noUi-handle").text(
							val + unit
						);
						console.log($(this).find(".noUi-handle").parent().parent().html());
					},
					set: function() {
						var val = Math.floor($(this).val());
						$(this).find(".noUi-handle").text(
							val + unit
						);
					}
				});
				$(my).val(def, true);
			}
			huadong('.slider-minmax1', "分钟", "5", 30);
			huadong('.slider-minmax2', "分钟", "6", 15);
			huadong('.slider-minmax3', "分钟", "10", 60);
			huadong('.slider-minmax4', "次", "2", 10);
			huadong('.slider-minmax5', "天", "3", 7);
			huadong('.slider-minmax6', "天", "8", 10);
		</script>
		<script type="text/javascript">

			var nameCookie = $.cookie('adminname');
			if (nameCookie == null){
				console.log(nameCookie);
				$("#personInfor").html(`<p><a href = "adminlogin.html">请登录</a></p>`);
			}else{
				$("#personInfor").html(`
					<p id="userName"></p>
					<p>
						<a href = "adminlogin.html">退出登录</a>
					</p>
				`);
				$("#userName").text(nameCookie);
			}

			var pageIndex = "";
			var key = "";
			$(function(){
				getOrderList();
			});
			//获取用户列表
			function getOrderList(){
				$.ajax({
					type:"post",
	        		url:"http://localhost:8080/手机商城/OrderServlet",
	        		data:{
    					pageIndex:pageIndex,
    					op:"getlist"
    				},
	        		dataType:"json",
	        		cache:false,
	        		success:function(data){
	        			console.log(data);
	        			$("#orderlist").html("");
	        			var order = data.orderlist;
	        			var user = data.userlist;
	        			var html ="";
	        			$(order).each(function(index,orderlist){
	        				var userlist = user[index];
	        				
	        				html += `
	        					<div class="row orderbody" id="orderbody">
	        					<div class="col-xs-2 orderid">
										${orderlist.orderId}
									</div>
									<div class="col-xs-1 userid">
										${orderlist.userId}
									</div>
									<div class="col-xs-1 receiver">
										${userlist.userName}
									</div>

									<div class="col-xs-2 createtime">
										${orderlist.createTime}
									</div>
									<div class="col-xs-2 address">
										${orderlist.address}
									</div>
									<div class="col-xs-2 phonenum">
										${orderlist.phoneNum}
									</div>
									<div class="col-xs-2">
										<button class="btn btn-success btn-xs" data-toggle="modal" data-target="#reviseOrder" data-orderid="" onclick="show(${orderlist.orderId})">订单详情</button>
										<button class="btn btn-danger btn-xs" data-toggle="modal" data-target="#deleteOrder" data-orderid="" ">删除</button>
								</div></div>
							`;
							
							htmldel = `<button type="button" class="btn btn-xs btn-white" 				data-dismiss="modal" >取消</button>
										<button type="button" class="btn  btn-xs btn-danger deletaorder" onclick="del(${orderlist.id})">删除</button>
										</div>
							`;
							
							
	        			})
	        			$("#orderlist").html(html);
	        			$(".modal-footer").append(htmldel);
	        			$("ul[class=pagination]").html("");
    						var pageList = `
    							<li>
									<a href="#">
										<font color="black">&laquo;</font>
									</a>
								</li>
							`;
						var pageList = `
    							<li>
									<a href="#">
										<font color="black">&laquo;</font>
									</a>
								</li>
							`;
    						for (var i = 1; i <= data.totalSize; i ++){
    							pageList += `
    								<li>
	    								<span >
	    									<font color="black" class="pageIndex">${i}</font>
	    								</span>
	    							</li>
    							`;
    						}
    						pageList += `
								<li>
									<a href="#">
										<font color="black">&raquo;</font>
									</a>
								</li>
								<li class="gray">
									<font color="black"id="totalSize"></font>
								</li>
							`;
							$("ul[class=pagination]").html(pageList);
							$("#totalSize").html("共" + data.totalSize + "页");
	        		}
				})
			}
			function getOrderListByKey(key){
				$.ajax({
					type:"post",
	        		url:"http://localhost:8080/手机商城/OrderServlet",
	        		data:{
    					pageIndex:pageIndex,
    					key:key,
    					op:"getlist"
    				},
	        		dataType:"json",
	        		cache:false,
	        		success:function(data){
	        			console.log(data);
	        			var order = data.orderlist;
	        			var user = data.userlist;
	        			var html ="";
	        			$(order).each(function(index,orderlist){
	        				var userlist = user[index];
	        				
	        				html += `
	        					<div class="row orderbody" id="orderbody">
	        					<div class="col-xs-2 orderid">
										${orderlist.orderId}
									</div>
									<div class="col-xs-1 userid">
										${orderlist.userId}
									</div>
									<div class="col-xs-1 receiver">
										${userlist.userName}
									</div>

									<div class="col-xs-2 createtime">
										${orderlist.createTime}
									</div>
									<div class="col-xs-2 address">
										${orderlist.address}
									</div>
									<div class="col-xs-2 phonenum">
										${orderlist.phoneNum}
									</div>
									<div class="col-xs-2">
										<button class="btn btn-success btn-xs" data-toggle="modal" data-target="#reviseOrder" data-orderid="" onclick="show(${orderlist.orderId})">订单详情</button>
										<button class="btn btn-danger btn-xs" data-toggle="modal" data-target="#deleteOrder" data-orderid="" ">删除</button>
								</div></div>
							`;
							
							htmldel = `<button type="button" class="btn btn-xs btn-white" 				data-dismiss="modal" >取消</button>
										<button type="button" class="btn  btn-xs btn-danger deletaorder" onclick="del(${orderlist.id})">删除</button>
										</div>
							`;
							
							
							
	        			})
	        			$(".tablebody").html(html);
	        			$(".modal-footer").append(htmldel);
	        			//添加分页效果
	        			$("ul[class=pagination]").html("");
    						var pageList = `
    							<li>
									<a href="#">
										<font color="black">&laquo;</font>
									</a>
								</li>
							`;
						var pageList = `
    							<li>
									<a href="#">
										<font color="black">&laquo;</font>
									</a>
								</li>
							`;
    						for (var i = 1; i <= data.totalSize; i ++){
    							pageList += `
    								<li>
	    								<span >
	    									<font color="black" class="pageIndex">${i}</font>
	    								</span>
	    							</li>
    							`;
    						}
    						pageList += `
								<li>
									<a href="#">
										<font color="black">&raquo;</font>
									</a>
								</li>
								<li class="gray">
									<font color="black"id="totalSize"></font>
								</li>
							`;
							$("ul[class=pagination]").html(pageList);
							$("#totalSize").html("共" + data.totalSize + "页");
	        		}
				})
			}
			function del(id){
					$.ajax({
						type:"post",
	        			url:"http://localhost:8080/手机商城/OrderServlet",
	        			data:"op=dellist&id="+id,
	        			dataType:"json",
	        			cache:false,
	        			success:function(data){
	        				if(data>0){
            					alert("删除成功");
                				window.location.href="adminorders.html";
            				}else{
            					alert("删除失败");
            				}
            			}
					})
				}
			function show(id){
					$.ajax({
						type:"post",
	        			url:"http://localhost:8080/手机商城/OrderServlet",
	        			data:"op=show&id="+id,
	        			dataType:"json",
	        			cache:false,
	        			success:function(data){
	        				console.log(data);
	        				var price =0;
	        				var number =0;
	        				var total =0;
	        				$(data).each(function(index,item){
	        				number = item.number
	        				price = item.price;
	        				total = price*number;
	        				console.log(item);
	        				console.log(number);
	        				htmlitem =  `<tr style="height: 160px;">
										<td class="product-iamge" id="phoneimage">
										<div class="img-wrapper"><img src="${item.image}" alt="product image"></div></td>
										<td class="product-name" id="phonename">${item.name}</td>
										<td class="product-price" id="phoneprice">${item.price}元</td>
										<td class="product-number" id="phonenum">${item.number}</td>
										<td class="product-total" id="phonetotal">${total}元</td>
										</tr>
							`;
	        				$("#itemlist").html(htmlitem);
            			})
					}
				})
			}
			//分页查询
			$(document).on("click", ".pageIndex", function(){
				pageIndex = $(this).html();
				if (key == ""){
					getOrderList();
				}else{
					getOrderListByKey(key);
				}
			});

			//模糊查询
			$(document).on("click", "#search", function(){
				//重置当前页
				pageIndex = "";
				key = $("#keyword").val();
				getOrderListByKey(key);
			});
		</script>
	</body>

</html>