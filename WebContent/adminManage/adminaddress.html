<!doctype html>
<html lang="ch">

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="description" content="手机商城后台">
		<meta name="keywords" content="手机商城后台">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		<meta name="format-detection" content="telephone=no">
		<title>手机商城后台</title>
		<script src="js/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script>
			$(function() {
				$(".meun-item").click(function() {
					$(".meun-item").removeClass("meun-item-active");
					$(this).addClass("meun-item-active");
					var itmeObj = $(".meun-item").find("img");
					itmeObj.each(function() {
						var items = $(this).attr("src");
						items = items.replace("_grey.png", ".png");
						items = items.replace(".png", "_grey.png")
						$(this).attr("src", items);
					});
					var attrObj = $(this).find("img").attr("src");;
					attrObj = attrObj.replace("_grey.png", ".png");
					$(this).find("img").attr("src", attrObj);
				});
				$("#topAD").click(function() {
					$("#topA").toggleClass(" glyphicon-triangle-right");
					$("#topA").toggleClass(" glyphicon-triangle-bottom");
				});
				$("#topBD").click(function() {
					$("#topB").toggleClass(" glyphicon-triangle-right");
					$("#topB").toggleClass(" glyphicon-triangle-bottom");
				});
				$("#topCD").click(function() {
					$("#topC").toggleClass(" glyphicon-triangle-right");
					$("#topC").toggleClass(" glyphicon-triangle-bottom");
				});
				$(".toggle-btn").click(function() {
					$("#leftMeun").toggleClass("show");
					$("#rightContent").toggleClass("pd0px");
				})
			})
		</script>
		<!--[if lt IE 9]>
  <script src="js/html5shiv.min.js"></script>
  <script src="js/respond.min.js"></script>
<![endif]-->
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="css/common.css" />
		<link rel="stylesheet" type="text/css" href="css/slide.css" />
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="css/flat-ui.min.css" />
		<link rel="stylesheet" type="text/css" href="css/jquery.nouislider.css">
	</head>

	<body>
		<div id="wrap">
			<!-- 左侧菜单栏目块 -->
			<div class="leftMeun" id="leftMeun">
				<div id="logoDiv">
					<p id="logoP"><img id="logo" alt="左右结构项目" src="images/logo.png"><span>手机商城后台</span></p>
				</div>
				<div id="personInfor">
					
				</div>
				<div class="meun-title">账号管理</div>
				<div class="meun-item"><a href="adminindex.html"><img src="images/icon_user_grey.png">用户管理</a></div>
				<div class="meun-item"><a href="adminphone.html"><span class="glyphicon glyphicon-phone"></span>&nbsp;&nbsp;&nbsp;&nbsp;手机管理</a></div>
				<div class="meun-item meun-item-active" href="#address" aria-controls="address" role="tab" data-toggle="tab">&nbsp;<span class="glyphicon glyphicon-tower"></span>&nbsp;&nbsp;&nbsp;&nbsp;地址管理</div>
				<div class="meun-item"><a href="admincomment.html"><span class="glyphicon glyphicon-edit"></span>&nbsp;&nbsp;&nbsp;&nbsp;评论管理</a></div>
				<div class="meun-item"><a href="adminorders.html">&nbsp;<span class="glyphicon glyphicon-gift"></span>&nbsp;&nbsp;&nbsp;&nbsp;订单管理</a></div>
				<div class="meun-item"><a href="adminimages.html">&nbsp;<span class="glyphicon glyphicon-picture"></span>&nbsp;&nbsp;&nbsp;&nbsp;图片管理</a></div>
				<div class="meun-item"><a href="adminrepassword.html"><img src="images/icon_change_grey.png">修改密码</a></div>

			</div>
			<!-- 右侧具体内容栏目 -->
			<div id="rightContent">
				<a class="toggle-btn" id="nimei">
					<i class="glyphicon glyphicon-align-justify"></i>
				</a>
				<!-- Tab panes -->
				<div class="tab-content">
					<!--添加用户-->

					<!-- 图片管理 -->

					<!--添加商品图片-->

					<!--修改商品图片-->

					<!--删除图片-->

					<!-- 权限管理模块 -->

					<!--手机管理模块-->

					<!--地址管理模块-->
					<div role="tabpanel" class="tab-pane active" id="address">
						<div class="check-div form-inline">
							<div class="col-xs-3">
								<button class="btn btn-yellow btn-xs" data-toggle="modal" data-target="#addAddress">添加地址 </button>
							</div>
							<div class="col-xs-4">
								<input type="text" id="keyword" class="form-control input-sm" placeholder="输入文字搜索">
								<button id="search" class="btn btn-white btn-xs ">查 询 </button>
							</div>
							
						</div>
						<div class="data-div">
							<div class="row tableHeader">
								<div class="col-xs-2 ">
									地址信息
								</div>
								<div class="col-xs-4">
									详细地址
								</div>
								<div class="col-xs-1">
									收货人姓名
								</div>
								<div class="col-xs-1">
									邮政编码
								</div>
								<div class="col-xs-2">
									手机号码
								</div>
								<div class="col-xs-2">
									操作
								</div>
							</div>
							<div class="tablebody" id="addressbody">

								
							</div>

						</div>
						<!--页码块-->
						<footer class="footer">
							<ul class="pagination">
								
							</ul>
						</footer>
					</div>
					<!--添加地址模块-->
					<div class="modal fade" id="addAddress" role="dialog" aria-labelledby="gridSystemModalLabel">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
									<h4 class="modal-title" id="gridSystemModalLabel">添加地址信息</h4>
								</div>
								<div class="modal-body">
									<div class="container-fluid">
										<form class="form-horizontal">
											<div class="form-group ">
												<label for="sName" class="col-xs-4 control-label">地址信息：</label>
												<div class="col-xs-8 ">
													<input type="email" class="form-control input-sm duiqi" id="addresscity1" placeholder="">
												</div>
											</div>
											<div class="form-group ">
												<label for="sName" class="col-xs-4 control-label">详细地址：</label>
												<div class="col-xs-8 ">
													<textarea class="form-control input-sm duiqi" id="addressdetail1" placeholder=""></textarea>
												</div>
											</div>
											<div class="form-group ">
												<label for="sName" class="col-xs-4 control-label">收货人姓名</label>
												<div class="col-xs-8 ">
													<input type="email" class="form-control input-sm duiqi" id="addressreceiver1" placeholder="">
												</div>
											</div>
											<div class="form-group ">
												<label for="sName" class="col-xs-4 control-label">邮政编码：</label>
												<div class="col-xs-8 ">
													<input type="email" class="form-control input-sm duiqi" id="addresspostalcode1" placeholder="">
												</div>
											</div>
											<div class="form-group ">
												<label for="sName" class="col-xs-4 control-label">手机号码：</label>
												<div class="col-xs-8 ">
													<input type="email" class="form-control input-sm duiqi" id="addressphonenum1" placeholder="">
												</div>
											</div>
											<div class="form-group ">
												<label for="sName" class="col-xs-4 control-label">用户ID：</label>
												<div class="col-xs-8 ">
													<input type="email" class="form-control input-sm duiqi" id="addressuserid1" placeholder="">
												</div>
											</div>
										</form>
									</div>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-xs btn-white" data-dismiss="modal">取 消</button>
									<button type="button" class="btn btn-xs btn-green addaddress" id="addAddressList">保 存</button>
								</div>
							</div>
							<!-- /.modal-content -->
						</div>
						<!-- /.modal-dialog -->
					</div>
					<!--地址修改模块-->
					<div class="modal fade" id="reviseAddress" role="dialog" aria-labelledby="gridSystemModalLabel">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
									<h4 class="modal-title" id="gridSystemModalLabel">修改地址信息</h4>
								</div>
								<div class="modal-body">
									<div class="container-fluid">
										<form class="form-horizontal">
											<input type="hidden" id="addressid">
											<div class="form-group ">
												<label for="sName" class="col-xs-4 control-label">地址信息：</label>
												<div class="col-xs-8 ">
													<input type="email" class="form-control input-sm duiqi" id="addresscity2" placeholder="">
												</div>
											</div>
											<div class="form-group ">
												<label for="sName" class="col-xs-4 control-label">详细地址：</label>
												<div class="col-xs-8 ">
													<textarea class="form-control input-sm duiqi" id="addressdetail2" placeholder=""></textarea>
												</div>
											</div>
											<div class="form-group ">
												<label for="sName" class="col-xs-4 control-label">收货人姓名</label>
												<div class="col-xs-8 ">
													<input type="email" class="form-control input-sm duiqi" id="addressreceiver2" placeholder="">
												</div>
											</div>
											<div class="form-group ">
												<label for="sName" class="col-xs-4 control-label">邮政编码：</label>
												<div class="col-xs-8 ">
													<input type="email" class="form-control input-sm duiqi" id="addresspostalcode2" placeholder="">
												</div>
											</div>
											<div class="form-group ">
												<label for="sName" class="col-xs-4 control-label">手机号码：</label>
												<div class="col-xs-8 ">
													<input type="email" class="form-control input-sm duiqi" id="addressphonenum2" placeholder="">
												</div>
											</div>
											<div class="form-group ">
												<label for="sName" class="col-xs-4 control-label">用户ID：</label>
												<div class="col-xs-8 " id="uid">
													<input type="text" class="form-control input-sm duiqi" id="addressuserid2" readonly="true" value="1">
												</div>
											</div>
										</form>
									</div>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-xs btn-white" data-dismiss="modal">取 消</button>
									<button type="button" class="btn btn-xs btn-green updateaddress">保 存</button>
								</div>
							</div>
							<!-- /.modal-content -->
						</div>
						<!-- /.modal-dialog -->
					</div>
					<!--地址删除警告-->
					<div class="modal fade" id="deleteAddress" role="dialog" aria-labelledby="gridSystemModalLabel">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
									<h4 class="modal-title" id="gridSystemModalLabel">提示</h4>
								</div>
								<input type="hidden" id="daddressid">
								<div class="modal-body">
									<div class="container-fluid">
										确定要删除该地址？删除后不可恢复！
									</div>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-xs btn-white" data-dismiss="modal">取 消</button>
									<button type="button" class="btn  btn-xs btn-danger deleteaddress">删除</button>
								</div>
							</div>
							<!-- /.modal-content -->
						</div>
						<!-- /.modal-dialog -->
					</div>
					<!--评论管理模块-->

					<!--添加评论模态框-->

					<!--评论详情模态框-->

					<!--删除评论模态框-->
					<!--订单管理模块-->

					<!--添加订单-->

					<!--订单修改模态框-->

					<!--订单删除模态框-->

					<!--添加手机模态框-->

					<!--用户管理模块-->
					<!-- 修改密码模块 -->

					<!--是否为会员管理模块-->

					<!--规则管理模块-->

					<!--时间段管理模块-->

					<!--座位管理模块-->
				</div>
			</div>
		</div>
		<!-- 滑块js -->
		<!--	<script type="text/javascript">
        scale = function(btn, bar, title, unit) {
                this.btn = document.getElementById(btn);
                this.bar = document.getElementById(bar);
                this.title = document.getElementById(title);
                this.step = this.bar.getElementsByTagName("div")[0];
                this.unit = unit;
                this.init();
        };
        scale.prototype = {
                init: function() {
                        var f = this,
                                g = document,
                                b = window,
                                m = Math;
                        f.btn.onmousedown = function(e) {
                                var x = (e || b.event).clientX;
                                var l = this.offsetLeft;
//						var max = f.bar.offsetWidth - this.offsetWidth;
                                var max = f.bar.offsetWidth-20 ;
                                g.onmousemove = function(e) {
                                        var thisX = (e || b.event).clientX;
                                        var to = m.min(max, m.max(-2, l + (thisX - x)));
                                        f.btn.style.left = to+ 'px';
                                        f.ondrag(m.round(m.max(0, to / max) * 100), to);
                                        b.getSelection ? b.getSelection().removeAllRanges() : g.selection.empty();
                                };
                                g.onmouseup = new Function('this.onmousemove=null');
                        };
                },
                ondrag: function(pos, x) {
                        this.step.style.width = Math.max(0, x) +2+ 'px';
                        this.title.innerHTML = pos / 10 + this.unit + "";
                }
        }
        new scale('btn0', 'bar0', 'title0', "分钟");
        new scale('btn1', 'bar1', 'title1', "分钟");
        new scale('btn2', 'bar2', 'title2', "天");
        new scale('btn3', 'bar3', 'title3', "次");
</script>
-->
		<script src="js/jquery.nouislider.js"></script>
		<script src="js/jquery.cookie.js"></script>

		<!-- this page specific inline scripts -->
		<script>
			//min/max slider
			function huadong(my, unit, def, max) {
				$(my).noUiSlider({
					range: [0, max],
					start: [def],
					handles: 1,
					connect: 'upper',
					slide: function() {
						var val = Math.floor($(this).val());
						$(this).find(".noUi-handle").text(
							val + unit
						);
						console.log($(this).find(".noUi-handle").parent().parent().html());
					},
					set: function() {
						var val = Math.floor($(this).val());
						$(this).find(".noUi-handle").text(
							val + unit
						);
					}
				});
				$(my).val(def, true);
			}
			huadong('.slider-minmax1', "分钟", "5", 30);
			huadong('.slider-minmax2', "分钟", "6", 15);
			huadong('.slider-minmax3', "分钟", "10", 60);
			huadong('.slider-minmax4', "次", "2", 10);
			huadong('.slider-minmax5', "天", "3", 7);
			huadong('.slider-minmax6', "天", "8", 10);
		</script>
		<script type="text/javascript">
			var nameCookie = $.cookie('adminname');
			if (nameCookie == null){
				console.log(nameCookie);
				$("#personInfor").html(`<p><a href = "adminlogin.html">请登录</a></p>`);
			}else{
				$("#personInfor").html(`
					<p id="userName"></p>
					<p>
						<a href = "adminlogin.html">退出登录</a>
					</p>
				`);
				$("#userName").text(nameCookie);
			}
			var key = "";
			var pageIndex = "";
			$(function(){
				getAddressList();
			});
			//添加地址
			$(document).on("click", "#addAddressList", function(){
				var city = $("#addresscity1").val();
				var detail = $("#addressdetail1").val();
				var receiver = $("#addressreceiver1").val();
				var postalcode = $("#addresspostalcode1").val();
				var phonenum = $("#addressphonenum1").val();
				var userid = $("#addressuserid1").val();
				console.log(userid);
				$.ajax({
    				type:"post",
    				url:"AddressServlet",
    				cache:false,
    				data:{
    					city:city,
    					detail:detail,
    					receiver:receiver,
    					postalcode:postalcode,
    					phonenum:phonenum,
    					userid:userid,
    					op:"addaddress"
    				},
    				dataType:"json",
    				success:function(data){
    					if (data>0) {
    						alert("添加成功");
    						window.location.href = "adminaddress.html";
    					}else{
    						alert("添加失败");
    					}
    				}
    			})
			});
			//打开删除对话框填充数据
			$(document).on("click", ".deladdress", function(){
				var id = $(this).data("addressid");
				
				$("#daddressid").val(id);
			});
			//打开修改模态框填充数据
			$(document).on("click", ".uaddress", function(){
				var id = $(this).data("addressid");
				$.ajax({
    				type:"post",
    				url:"AddressServlet",
    				cache:false,
    				data:{
    					id:id,
    					op:"addressinfo"
    				},
    				dataType:"json",
    				success:function(data){
    					console.log(data)
    					if (data != null) {
    						$("#daddressid").val(data.id);
							$("#addresscity2").val(data.city);
							$("#addressdetail2").val(data.detail);
							$("#addressreceiver2").val(data.name);
							$("#addresspostalcode2").val(data.postalcode);
							$("#addressphonenum2").val(data.phoneNum);
							var userid = `<input type="text" class="form-control input-sm duiqi" id="addressuserid2" readonly="true" value="${data.userId}">`
							$("#uid").html(userid);
    					}
    				}
    			})
			});
			function getAddressList(){
				$.ajax({
					type:"post",
	        		url:"AddressServlet",
	        		data:{
    					pageIndex:pageIndex,
    					op:"getlist"
    				},
	        		dataType:"json",
	        		cache:false,
	        		success:function(data){
	        			var addresslist = data.addresslist;
	        			var html ="";
	        			$(addresslist).each(function(index,address){
	        				html += `<div class="row adddressbody">
									<div class="col-xs-2 addresscity">
										${address.city}
									</div>
									<div class="col-xs-4 addressdetail">
										${address.detail}
									</div>
									<div class="col-xs-1 addressreceicer">
										${address.name}
									</div>
									<div class="col-xs-1 addresspostalcode">
										${address.postalcode}
									</div>
									<div class="col-xs-2 addressphonenum">
										${address.phoneNum}
									</div>
									<div class="col-xs-2">
										<button class="btn btn-success btn-xs uaddress" data-toggle="modal" data-target="#reviseAddress" data-addressid="${address.id}">修改</button>
										<button class="btn btn-danger btn-xs deladdress" data-toggle="modal" data-target="#deleteAddress"  data-addressid="${address.id}">删除</button>
									</div>
								</div>`;
							
							$("ul[class=pagination]").html("");
    						var pageList = `
    							<li>
									<a href="#">
										<font color="black">&laquo;</font>
									</a>
								</li>
							`;
							var pageList = `
    							<li>
									<a href="#">
										<font color="black">&laquo;</font>
									</a>
								</li>
							`;
    						for (var i = 1; i <= data.totalSize; i ++){
    							pageList += `
    								<li>
	    								<span >
	    									<font color="black" class="pageIndex">${i}</font>
	    								</span>
	    							</li>
    							`;
    						}
    						pageList += `
								<li>
									<a href="#">
										<font color="black">&raquo;</font>
									</a>
								</li>
								<li class="gray">
									<font color="black"id="totalSize"></font>
								</li>
							`;
							
							$("ul[class=pagination]").html(pageList);
							$("#totalSize").html("共" + data.totalSize + "页");
	        			})
	        			$("#addressbody").html(html);
	        		}
	        	})
			}

			function getAddressListByKey(key){
				$.ajax({
					type:"post",
	        		url:"AddressServlet",
	        		data:{
    					pageIndex:pageIndex,
    					key:key,
    					op:"getlist"
    				},
	        		dataType:"json",
	        		cache:false,
	        		success:function(data){
	        			var addresslist = data.addresslist;
	        			
	        			var html ="";
	        			$(addresslist).each(function(index,address){
	        				console.log(address);
	        				html += `<div class="row adddressbody">
									<div class="col-xs-2 addresscity">
										${address.city}
									</div>
									<div class="col-xs-4 addressdetail">
										${address.detail}
									</div>
									<div class="col-xs-1 addressreceicer">
										${address.name}
									</div>
									<div class="col-xs-1 addresspostalcode">
										${address.postalcode}
									</div>
									<div class="col-xs-2 addressphonenum">
										${address.phoneNum}
									</div>
									<div class="col-xs-2">
										<button class="btn btn-success btn-xs" data-toggle="modal" data-target="#reviseAddress" data-addressid="${address.id}">修改</button>
										<button class="btn btn-danger btn-xs" data-toggle="modal" data-target="#deleteAddress"  data-addressid="${address.id}">删除</button>
									</div>
								</div>`;
							
							$("ul[class=pagination]").html("");
    						var pageList = `
    							<li>
									<a href="#">
										<font color="black">&laquo;</font>
									</a>
								</li>
							`;
							var pageList = `
    							<li>
									<a href="#">
										<font color="black">&laquo;</font>
									</a>
								</li>
							`;
    						for (var i = 1; i <= data.totalSize; i ++){
    							pageList += `
    								<li>
	    								<span >
	    									<font color="black" class="pageIndex">${i}</font>
	    								</span>
	    							</li>
    							`;
    						}
    						pageList += `
								<li>
									<a href="#">
										<font color="black">&raquo;</font>
									</a>
								</li>
								<li class="gray">
									<font color="black"id="totalSize"></font>
								</li>
							`;
							$("ul[class=pagination]").html(pageList);
							$("#totalSize").html("共" + data.totalSize + "页");
	        			})
	        			$("#addressbody").html(html);
	        		}
	        	})
			}
			//修改
			$(document).on("click", ".updateaddress", function(){

				var id = $("#daddressid").val();
				var city = $("#addresscity2").val();
				var detail = $("#addressdetail2").val();
				var receiver = $("#addressreceiver2").val();
				var postalcode = $("#addresspostalcode2").val();
				var phonenum = $("#addressphonenum2").val();
				var userid = $("#addressuserid2").val();

				$.ajax({
    				type:"post",
    				url:"AddressServlet",
    				cache:false,
    				data:{
    					id:id,
    					city:city,
    					detail:detail,
    					receiver:receiver,
    					postalcode:postalcode,
    					phonenum:phonenum,
    					userid:userid,
    					op:"updateaddress"
    				},
    				dataType:"json",
    				success:function(data){
    					if (data>0) {
    						alert("更新成功");
    						if (key == ""){
								getAddressList();
								window.location.href = "adminaddress.html";
							}else{
								getAddressListByKey(key);
							}
    					}else{
    						alert("更新失败");
    					}
    				}
    			})
			})
			//删除
			$(document).on("click", ".deleteaddress", function(){
				var id = $("#daddressid").val();
				
				$.ajax({
    				type:"post",
    				url:"AddressServlet",
    				cache:false,
    				data:{
    					id:id,
    					op:"deleteaddress"
    				},
    				dataType:"json",
    				success:function(data){
    					if (data>0) {
    						alert("删除成功");
    						if (key == ""){
								getAddressList();
								window.location.href = "adminaddress.html";
							}else{
								getAddressListByKey(key);
							}
    					}else{
    						alert("删除失败");
    					}
    				}
    			})
			})

			$(document).on("click", ".pageIndex", function(){
				pageIndex = $(this).html();
				if (key == ""){
					getAddressList();
				}else{
					getAddressListByKey(key);
				}
			});

			//模糊查询
			$(document).on("click", "#search", function(){
				//重置当前页
				pageIndex = "";
				key = $("#keyword").val();
				getAddressListByKey(key);
			});
		</script>
	</body>

</html>